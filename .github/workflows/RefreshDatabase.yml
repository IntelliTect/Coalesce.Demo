name: Refresh Database

on:
  schedule: 
    - cron: "0 0 * * *"
  workflow_dispatch:
jobs:
  RefreshData:
    runs-on: ubuntu-latest
    env:
      CONNECTION_STRING: ${{ secrets.CONNECTION_STRING }} 
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2.2.2
      - uses: BSFishy/pip-action@v1
        with:
          packages: pyodbc
      - run: |
          import os
          with pyodbc.connect(os.environ['CONNECTION_STRING']) as conn:
            with conn.cursor() as cursor:
                dropFile = open("./RefreshDB/DropValues.sql", "r")
                insertFile = open("./RefreshDB/InsertSeededValues.sql", "r")

                dropQuery = dropFile.read()
                insertQuery = insertFile.read()

                cursor.execute(dropQuery)
                cursor.execute(insertQuery)  
        
            
          
